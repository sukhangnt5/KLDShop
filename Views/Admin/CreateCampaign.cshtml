@model KLDShop.Models.EmailCampaign
@{
    ViewData["Title"] = "T·∫°o Email Campaign";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <h2><i class="bi bi-mailbox"></i> T·∫°o Email Campaign</h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-action="Dashboard">Dashboard</a></li>
                    <li class="breadcrumb-item"><a asp-action="Newsletter">Newsletter</a></li>
                    <li class="breadcrumb-item active">T·∫°o Campaign</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5><i class="bi bi-pencil-square"></i> Th√¥ng Tin Campaign</h5>
                </div>
                <div class="card-body">
                    <form method="post" asp-action="CreateCampaign" id="campaign-form">
                        @Html.AntiForgeryToken()
                        
                        <div class="mb-3">
                            <label for="Subject" class="form-label">Ti√™u ƒê·ªÅ Email <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="Subject" name="Subject" required maxlength="255">
                            <div class="form-text">Ti√™u ƒë·ªÅ s·∫Ω hi·ªÉn th·ªã trong h·ªôp th∆∞ c·ªßa ng∆∞·ªùi nh·∫≠n</div>
                        </div>

                        <div class="mb-3">
                            <label for="PreviewText" class="form-label">VƒÉn B·∫£n Xem Tr∆∞·ªõc</label>
                            <input type="text" class="form-control" id="PreviewText" name="PreviewText" maxlength="500">
                            <div class="form-text">VƒÉn b·∫£n m√¥ t·∫£ ng·∫Øn hi·ªÉn th·ªã b√™n c·∫°nh ti√™u ƒë·ªÅ email</div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="FromName" class="form-label">T√™n Ng∆∞·ªùi G·ª≠i <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="FromName" name="FromName" value="KLDShop" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="FromEmail" class="form-label">Email Ng∆∞·ªùi G·ª≠i <span class="text-danger">*</span></label>
                                <input type="email" class="form-control" id="FromEmail" name="FromEmail" value="info@kldshop.com" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="ReplyTo" class="form-label">Email Ph·∫£n H·ªìi</label>
                            <input type="email" class="form-control" id="ReplyTo" name="ReplyTo" value="support@kldshop.com">
                        </div>

                        <div class="mb-3">
                            <label for="HtmlContent" class="form-label">N·ªôi Dung Email (HTML) <span class="text-danger">*</span></label>
                            <div class="btn-toolbar mb-2" role="toolbar">
                                <div class="btn-group me-2" role="group">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="insertTemplate('welcome')">
                                        <i class="bi bi-file-text"></i> M·∫´u Ch√†o M·ª´ng
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="insertTemplate('promotion')">
                                        <i class="bi bi-tag"></i> M·∫´u Khuy·∫øn M√£i
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="insertTemplate('newsletter')">
                                        <i class="bi bi-newspaper"></i> M·∫´u Tin T·ª©c
                                    </button>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="togglePreview()">
                                    <i class="bi bi-eye"></i> Xem Tr∆∞·ªõc
                                </button>
                            </div>
                            <textarea class="form-control font-monospace" id="HtmlContent" name="HtmlContent" rows="15" required></textarea>
                            <div class="form-text">S·ª≠ d·ª•ng HTML ƒë·ªÉ t·∫°o n·ªôi dung email</div>
                        </div>

                        <div class="mb-3">
                            <label for="ScheduledAt" class="form-label">L√™n L·ªãch G·ª≠i (T√πy Ch·ªçn)</label>
                            <input type="datetime-local" class="form-control" id="ScheduledAt" name="ScheduledAt">
                            <div class="form-text">ƒê·ªÉ tr·ªëng ƒë·ªÉ l∆∞u nh√°p, ho·∫∑c ch·ªçn th·ªùi gian ƒë·ªÉ l√™n l·ªãch g·ª≠i</div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex">
                            <button type="submit" name="action" value="draft" class="btn btn-secondary">
                                <i class="bi bi-save"></i> L∆∞u Nh√°p
                            </button>
                            <button type="submit" name="action" value="schedule" class="btn btn-warning">
                                <i class="bi bi-clock"></i> L√™n L·ªãch G·ª≠i
                            </button>
                            <button type="submit" name="action" value="send" class="btn btn-primary">
                                <i class="bi bi-send"></i> G·ª≠i Ngay
                            </button>
                            <a asp-action="Newsletter" class="btn btn-outline-secondary">
                                <i class="bi bi-x"></i> H·ªßy
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5><i class="bi bi-eye"></i> Xem Tr∆∞·ªõc Email</h5>
                </div>
                <div class="card-body">
                    <div id="email-preview" class="border p-3 bg-light" style="min-height: 400px;">
                        <p class="text-muted text-center">Nh·∫≠p n·ªôi dung HTML v√† nh·∫•n "Xem Tr∆∞·ªõc" ƒë·ªÉ xem k·∫øt qu·∫£</p>
                    </div>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">
                    <h5><i class="bi bi-info-circle"></i> H∆∞·ªõng D·∫´n</h5>
                </div>
                <div class="card-body">
                    <ul class="small">
                        <li>S·ª≠ d·ª•ng c√°c m·∫´u c√≥ s·∫µn ƒë·ªÉ b·∫Øt ƒë·∫ßu nhanh</li>
                        <li>N·ªôi dung email h·ªó tr·ª£ HTML ƒë·∫ßy ƒë·ªß</li>
                        <li>Ki·ªÉm tra xem tr∆∞·ªõc tr∆∞·ªõc khi g·ª≠i</li>
                        <li>C√≥ th·ªÉ l∆∞u nh√°p ƒë·ªÉ ch·ªânh s·ª≠a sau</li>
                        <li>L√™n l·ªãch g·ª≠i v√†o th·ªùi gian ph√π h·ª£p</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function insertTemplate(type) {
            let template = '';
            
            if (type === 'welcome') {
                template = `<!DOCTYPE html>
<html>
<head>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: #1b6ec2; color: white; padding: 20px; text-align: center; }
        .content { padding: 20px; background: #f9f9f9; }
        .button { display: inline-block; padding: 10px 20px; background: #1b6ec2; color: white; text-decoration: none; border-radius: 5px; }
        .footer { text-align: center; padding: 20px; font-size: 12px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ch√†o M·ª´ng ƒê·∫øn V·ªõi KLDShop!</h1>
        </div>
        <div class="content">
            <h2>Xin ch√†o!</h2>
            <p>C·∫£m ∆°n b·∫°n ƒë√£ ƒëƒÉng k√Ω nh·∫≠n tin t·ª´ KLDShop. Ch√∫ng t√¥i r·∫•t vui ƒë∆∞·ª£c c√≥ b·∫°n trong c·ªông ƒë·ªìng c·ªßa m√¨nh!</p>
            <p>B·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c c√°c th√¥ng tin v·ªÅ:</p>
            <ul>
                <li>S·∫£n ph·∫©m m·ªõi nh·∫•t</li>
                <li>∆Øu ƒë√£i ƒë·∫∑c bi·ªát</li>
                <li>Tin t·ª©c v√† s·ª± ki·ªán</li>
            </ul>
            <p style="text-align: center;">
                <a href="https://kldshop.com" class="button">Kh√°m Ph√° Ngay</a>
            </p>
        </div>
        <div class="footer">
            <p>&copy; 2025 KLDShop. All rights reserved.</p>
            <p><a href="#">H·ªßy ƒëƒÉng k√Ω</a></p>
        </div>
    </div>
</body>
</html>`;
            } else if (type === 'promotion') {
                template = `<!DOCTYPE html>
<html>
<head>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        .container { max-width: 600px; margin: 0 auto; }
        .banner { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; text-align: center; }
        .promo-code { background: #ffd93d; color: #333; font-size: 24px; font-weight: bold; padding: 15px; margin: 20px 0; border-radius: 5px; }
        .content { padding: 30px; }
        .cta { display: inline-block; padding: 15px 30px; background: #ff6b6b; color: white; text-decoration: none; border-radius: 25px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="banner">
            <h1>üéâ KHUY·∫æN M√ÉI ƒê·∫∂C BI·ªÜT üéâ</h1>
            <h2>GI·∫¢M GI√Å 50% CHO T·∫§T C·∫¢ S·∫¢N PH·∫®M</h2>
        </div>
        <div class="content">
            <p>ƒê·ª´ng b·ªè l·ª° c∆° h·ªôi tuy·ªát v·ªùi n√†y!</p>
            <div class="promo-code">M√É: SALE50</div>
            <p>√Åp d·ª•ng m√£ gi·∫£m gi√° khi thanh to√°n ƒë·ªÉ nh·∫≠n ∆∞u ƒë√£i.</p>
            <p style="text-align: center;">
                <a href="https://kldshop.com/products" class="cta">MUA NGAY</a>
            </p>
            <p style="font-size: 12px; color: #666;">* Ch∆∞∆°ng tr√¨nh c√≥ hi·ªáu l·ª±c ƒë·∫øn h·∫øt ng√†y 31/12/2025</p>
        </div>
    </div>
</body>
</html>`;
            } else if (type === 'newsletter') {
                template = `<!DOCTYPE html>
<html>
<head>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; }
        .container { max-width: 600px; margin: 0 auto; background: white; }
        .header { background: #2c3e50; color: white; padding: 20px; }
        .article { padding: 20px; border-bottom: 1px solid #eee; }
        .article h3 { color: #2c3e50; margin-top: 0; }
        .read-more { color: #3498db; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì∞ KLDShop Newsletter</h1>
            <p>Tin t·ª©c & C·∫≠p nh·∫≠t m·ªõi nh·∫•t</p>
        </div>
        <div class="article">
            <h3>S·∫£n Ph·∫©m M·ªõi Nh·∫•t Th√°ng 12</h3>
            <p>Kh√°m ph√° b·ªô s∆∞u t·∫≠p s·∫£n ph·∫©m m·ªõi nh·∫•t c·ªßa ch√∫ng t√¥i v·ªõi nhi·ªÅu m·∫´u m√£ h·∫•p d·∫´n...</p>
            <a href="#" class="read-more">ƒê·ªçc th√™m ‚Üí</a>
        </div>
        <div class="article">
            <h3>Tips & Tricks</h3>
            <p>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng s·∫£n ph·∫©m hi·ªáu qu·∫£ v√† ti·∫øt ki·ªám...</p>
            <a href="#" class="read-more">ƒê·ªçc th√™m ‚Üí</a>
        </div>
        <div style="padding: 20px; text-align: center; background: #ecf0f1;">
            <p>C·∫£m ∆°n b·∫°n ƒë√£ ƒëƒÉng k√Ω nh·∫≠n tin!</p>
            <p style="font-size: 12px;"><a href="#">H·ªßy ƒëƒÉng k√Ω</a> | <a href="#">C·∫≠p nh·∫≠t t√πy ch·ªçn</a></p>
        </div>
    </div>
</body>
</html>`;
            }
            
            document.getElementById('HtmlContent').value = template;
        }

        function togglePreview() {
            const content = document.getElementById('HtmlContent').value;
            const preview = document.getElementById('email-preview');
            preview.innerHTML = content || '<p class="text-muted text-center">Nh·∫≠p n·ªôi dung HTML ƒë·ªÉ xem tr∆∞·ªõc</p>';
        }

        // Auto-preview on content change (debounced)
        let previewTimeout;
        document.getElementById('HtmlContent').addEventListener('input', function() {
            clearTimeout(previewTimeout);
            previewTimeout = setTimeout(togglePreview, 1000);
        });
    </script>
}
