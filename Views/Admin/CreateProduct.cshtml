@model Product

@{
    ViewData["Title"] = "Th√™m S·∫£n Ph·∫©m M·ªõi - Admin";
}

<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="h3 d-inline-block">
                <i class="bi bi-plus-circle"></i> Th√™m S·∫£n Ph·∫©m M·ªõi
            </h1>
            <a href="@Url.Action("Products", "Admin")" class="btn btn-outline-secondary float-end">
                <i class="bi bi-arrow-left"></i> Quay L·∫°i
            </a>
        </div>
    </div>

    <!-- Success/Error Messages -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle"></i> @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-circle"></i> @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <!-- Form -->
    <form asp-action="CreateProduct" method="post" class="needs-validation" novalidate>
        <div class="card shadow-sm border-0">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Th√¥ng Tin S·∫£n Ph·∫©m</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Basic Information -->
                    <div class="col-md-8">
                        <h6 class="text-primary mb-3">Th√¥ng Tin C∆° B·∫£n</h6>
                        
                        <div class="mb-3">
                            <label asp-for="ProductName" class="form-label">T√™n S·∫£n Ph·∫©m <span class="text-danger">*</span></label>
                            <input asp-for="ProductName" class="form-control" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m" required />
                            <span asp-validation-for="ProductName" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Description" class="form-label">M√¥ T·∫£</label>
                            <textarea asp-for="Description" class="form-control" rows="5" placeholder="Nh·∫≠p m√¥ t·∫£ chi ti·∫øt s·∫£n ph·∫©m"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="price-display" class="form-label">Gi√° <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <input type="text" id="price-display" class="form-control price-input" placeholder="1,000,000" required />
                                    <span class="input-group-text">ƒë</span>
                                </div>
                                <input asp-for="Price" type="hidden" id="price-hidden" />
                                <span asp-validation-for="Price" class="text-danger"></span>
                                <small class="form-text text-muted">Nh·∫≠p s·ªë, t·ª± ƒë·ªông format v·ªõi d·∫•u ph·∫©y</small>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="discount-display" class="form-label">Gi√° Khuy·∫øn M√£i</label>
                                <div class="input-group">
                                    <input type="text" id="discount-display" class="form-control price-input" placeholder="900,000" />
                                    <span class="input-group-text">ƒë</span>
                                </div>
                                <input asp-for="DiscountPrice" type="hidden" id="discount-hidden" />
                                <span asp-validation-for="DiscountPrice" class="text-danger"></span>
                                <small class="form-text text-muted">ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng c√≥ khuy·∫øn m√£i</small>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Quantity" class="form-label">S·ªë L∆∞·ª£ng <span class="text-danger">*</span></label>
                                <input asp-for="Quantity" type="number" class="form-control" placeholder="0" required />
                                <span asp-validation-for="Quantity" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="CategoryId" class="form-label">Danh M·ª•c</label>
                                <select asp-for="CategoryId" class="form-select">
                                    <option value="">-- Ch·ªçn Danh M·ª•c --</option>
                                    @foreach (var category in ViewBag.Categories as List<Category>)
                                    {
                                        <option value="@category.CategoryId">@category.CategoryName</option>
                                    }
                                </select>
                                <span asp-validation-for="CategoryId" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Image" class="form-label">URL H√¨nh ·∫¢nh Ch√≠nh</label>
                            <input asp-for="Image" class="form-control" placeholder="https://example.com/image.jpg" />
                            <span asp-validation-for="Image" class="text-danger"></span>
                            <small class="form-text text-muted">·∫¢nh ch√≠nh hi·ªÉn th·ªã ƒë·∫ßu ti√™n</small>
                        </div>

                        <hr class="my-3" />
                        <h6 class="text-primary mb-3">·∫¢nh Ph·ª• (T·ªëi ƒëa 4 ·∫£nh)</h6>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="image1" class="form-label">·∫¢nh ph·ª• 1</label>
                                <input type="text" id="image1" name="ProductImages[0].ImageUrl" class="form-control" placeholder="https://example.com/image1.jpg" />
                                <input type="hidden" name="ProductImages[0].DisplayOrder" value="1" />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="image2" class="form-label">·∫¢nh ph·ª• 2</label>
                                <input type="text" id="image2" name="ProductImages[1].ImageUrl" class="form-control" placeholder="https://example.com/image2.jpg" />
                                <input type="hidden" name="ProductImages[1].DisplayOrder" value="2" />
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="image3" class="form-label">·∫¢nh ph·ª• 3</label>
                                <input type="text" id="image3" name="ProductImages[2].ImageUrl" class="form-control" placeholder="https://example.com/image3.jpg" />
                                <input type="hidden" name="ProductImages[2].DisplayOrder" value="3" />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="image4" class="form-label">·∫¢nh ph·ª• 4</label>
                                <input type="text" id="image4" name="ProductImages[3].ImageUrl" class="form-control" placeholder="https://example.com/image4.jpg" />
                                <input type="hidden" name="ProductImages[3].DisplayOrder" value="4" />
                            </div>
                        </div>
                        
                        <small class="form-text text-muted d-block mb-3">
                            <i class="bi bi-info-circle"></i> ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng c√≥ ·∫£nh ph·ª•. ·∫¢nh s·∫Ω hi·ªÉn th·ªã ·ªü trang chi ti·∫øt s·∫£n ph·∫©m.
                        </small>

                        <hr class="my-4" />
                        <h6 class="text-primary mb-3">Th√¥ng Tin B·ªï Sung</h6>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label asp-for="SKU" class="form-label">M√£ SKU</label>
                                <input asp-for="SKU" class="form-control" placeholder="SKU-001" />
                                <span asp-validation-for="SKU" class="text-danger"></span>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label asp-for="Weight" class="form-label">Tr·ªçng L∆∞·ª£ng (kg)</label>
                                <input asp-for="Weight" type="number" step="0.01" class="form-control" placeholder="0.00" />
                                <span asp-validation-for="Weight" class="text-danger"></span>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label asp-for="Dimensions" class="form-label">K√≠ch Th∆∞·ªõc</label>
                                <input asp-for="Dimensions" class="form-control" placeholder="10x20x30 cm" />
                                <span asp-validation-for="Dimensions" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Manufacturer" class="form-label">Nh√† S·∫£n Xu·∫•t</label>
                                <input asp-for="Manufacturer" class="form-control" placeholder="T√™n nh√† s·∫£n xu·∫•t" />
                                <span asp-validation-for="Manufacturer" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="WarrantyPeriod" class="form-label">B·∫£o H√†nh (th√°ng)</label>
                                <input asp-for="WarrantyPeriod" type="number" class="form-control" placeholder="12" />
                                <span asp-validation-for="WarrantyPeriod" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <!-- SEO & Status -->
                    <div class="col-md-4">
                        <h6 class="text-primary mb-3">SEO & Tr·∫°ng Th√°i</h6>
                        
                        <div class="mb-3">
                            <label asp-for="MetaDescription" class="form-label">Meta Description</label>
                            <textarea asp-for="MetaDescription" class="form-control" rows="3" placeholder="M√¥ t·∫£ ng·∫Øn cho SEO (160 k√Ω t·ª±)"></textarea>
                            <span asp-validation-for="MetaDescription" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="MetaKeywords" class="form-label">Meta Keywords</label>
                            <input asp-for="MetaKeywords" class="form-control" placeholder="keyword1, keyword2, keyword3" />
                            <span asp-validation-for="MetaKeywords" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="IsActive" class="form-check-input" type="checkbox" checked />
                                <label asp-for="IsActive" class="form-check-label">K√≠ch Ho·∫°t S·∫£n Ph·∫©m</label>
                            </div>
                        </div>

                        <div class="card bg-light mt-4">
                            <div class="card-body">
                                <h6 class="card-title">üí° L∆∞u √ù</h6>
                                <ul class="small mb-0">
                                    <li>C√°c tr∆∞·ªùng c√≥ d·∫•u <span class="text-danger">*</span> l√† b·∫Øt bu·ªôc</li>
                                    <li>Slug s·∫Ω t·ª± ƒë·ªông t·∫°o t·ª´ t√™n s·∫£n ph·∫©m</li>
                                    <li>Gi√° khuy·∫øn m√£i ph·∫£i nh·ªè h∆°n gi√° g·ªëc</li>
                                    <li>URL h√¨nh ·∫£nh ph·∫£i l√† ƒë∆∞·ªùng d·∫´n h·ª£p l·ªá</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer bg-light">
                <div class="d-flex justify-content-between">
                    <a href="@Url.Action("Products", "Admin")" class="btn btn-secondary">
                        <i class="bi bi-x-circle"></i> H·ªßy
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save"></i> L∆∞u S·∫£n Ph·∫©m
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        // Format number with commas
        function formatNumber(input) {
            // Remove all commas and non-digit characters
            let value = input.value.replace(/[^0-9]/g, '');
            
            // If empty, leave it empty
            if (value === '') {
                input.value = '';
                return;
            }
            
            // Convert to number and format with commas
            let numValue = parseInt(value);
            if (!isNaN(numValue)) {
                input.value = numValue.toLocaleString('en-US');
            }
        }

        // Update hidden input with clean value
        function updateHiddenInput(displayInput, hiddenInput) {
            let value = displayInput.value.replace(/[^0-9]/g, '');
            hiddenInput.value = value;
        }

        // Format as user types
        function formatOnInput(input) {
            let cursorPosition = input.selectionStart;
            let oldValue = input.value;
            let oldLength = oldValue.length;
            
            // Remove all commas and non-digit characters
            let value = input.value.replace(/[^0-9]/g, '');
            
            if (value === '') {
                input.value = '';
                // Update corresponding hidden input
                if (input.id === 'price-display') {
                    document.getElementById('price-hidden').value = '';
                } else if (input.id === 'discount-display') {
                    document.getElementById('discount-hidden').value = '';
                }
                return;
            }
            
            // Format with commas
            let numValue = parseInt(value);
            if (!isNaN(numValue)) {
                input.value = numValue.toLocaleString('en-US');
                
                // Update corresponding hidden input with clean value
                if (input.id === 'price-display') {
                    document.getElementById('price-hidden').value = numValue;
                } else if (input.id === 'discount-display') {
                    document.getElementById('discount-hidden').value = numValue;
                }
                
                // Adjust cursor position
                let newLength = input.value.length;
                let diff = newLength - oldLength;
                input.selectionStart = input.selectionEnd = cursorPosition + diff;
            }
        }

        // Form submission - just make sure hidden fields are updated
        document.querySelector('form').addEventListener('submit', function(e) {
            // Sync display to hidden one more time before submit
            let priceDisplay = document.getElementById('price-display');
            let priceHidden = document.getElementById('price-hidden');
            let discountDisplay = document.getElementById('discount-display');
            let discountHidden = document.getElementById('discount-hidden');
            
            if (priceDisplay && priceDisplay.value) {
                priceHidden.value = priceDisplay.value.replace(/[^0-9]/g, '');
            }
            
            if (discountDisplay && discountDisplay.value) {
                discountHidden.value = discountDisplay.value.replace(/[^0-9]/g, '');
            }
        });

        // Add event listeners to price inputs
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.price-input').forEach(function(input) {
                // Format on blur
                input.addEventListener('blur', function() {
                    formatNumber(this);
                });
                
                // Format on input (real-time)
                input.addEventListener('input', function() {
                    formatOnInput(this);
                });
            });
        });
    </script>
}

<style>
    .card {
        border-radius: 10px;
    }
    .form-label {
        font-weight: 500;
    }
</style>
