@model Product

@{
    ViewData["Title"] = Model?.ProductName + " - KLDShop";
    
    // Create SEO-friendly meta description
    var description = !string.IsNullOrEmpty(Model?.Description) && Model.Description.Length > 100 
        ? Model.Description.Substring(0, 97) + "..." 
        : (Model?.Description ?? "Sản phẩm chất lượng cao");
    var priceText = Model?.DiscountPrice.HasValue == true 
        ? $"Giá chỉ {Model.DiscountPrice.Value:N0}đ (Giảm {(int)((1 - Model.DiscountPrice.Value / Model.Price) * 100)}%)" 
        : $"Giá {Model?.Price:N0}đ";
    ViewData["MetaDescription"] = $"Mua {Model?.ProductName} chính hãng tại KLDShop. {description} {priceText}. Miễn phí vận chuyển, đổi trả trong 30 ngày. Bảo hành chính hãng. Đặt hàng ngay!";
    
    var productUrl = ViewData["OgUrl"]?.ToString() ?? "";
    var productImage = ViewData["OgImage"]?.ToString() ?? "";
    var price = Model?.DiscountPrice ?? Model?.Price ?? 0;
    var currency = "VND";
    var availability = Model?.Quantity > 0 ? "https://schema.org/InStock" : "https://schema.org/OutOfStock";
    
    // Breadcrumb data
    var breadcrumbs = new List<(string Title, string Url)>
    {
        ("Trang Chủ", Url.Action("Index", "Home") ?? "/"),
        ("Sản Phẩm", Url.Action("List", "Product") ?? "/Product/List"),
        (Model?.ProductName ?? "Chi tiết sản phẩm", "")
    };
}

@await Html.PartialAsync("_Breadcrumb", breadcrumbs)

<div class="row">
    <!-- Product Images -->
    <div class="col-md-5 mb-4">
        <div class="card">
            <div class="position-relative">
                <img src="@(string.IsNullOrEmpty(Model?.Image) ? "https://via.placeholder.com/500x500?text=" + System.Net.WebUtility.UrlEncode(Model?.ProductName) : Model.Image)" 
                     class="card-img-top" 
                     alt="@Model?.ProductName - Chi tiết sản phẩm tại KLDShop"
                     id="main-image"
                     loading="eager"
                     decoding="async"
                     width="500"
                     height="500"
                     itemprop="image"
                     style="cursor: pointer;"
                     title="Click để quay lại ảnh chính"
                     onclick="resetMainImage()">
                @if (Model?.DiscountPrice.HasValue == true)
                {
                    var discountPercent = (int)((1 - Model.DiscountPrice.Value / Model.Price) * 100);
                    <span class="badge bg-danger position-absolute top-0 end-0 m-3">-@discountPercent%</span>
                }
            </div>
            <div class="card-body">
                <div class="row g-2">
                    @{
                        var productImages = Model?.ProductImages?.OrderBy(pi => pi.DisplayOrder).Take(4).ToList() ?? new List<ProductImage>();
                        var mainImage = Model?.Image ?? $"https://via.placeholder.com/500x500?text={System.Net.WebUtility.UrlEncode(Model?.ProductName)}";
                        
                        // If we have product images, use them; otherwise use placeholders
                        if (productImages.Any())
                        {
                            foreach (var img in productImages)
                            {
                                <div class="col-3">
                                    <img src="@img.ImageUrl" 
                                         class="img-thumbnail product-thumbnail @(img.IsMain ? "border-primary border-3" : "")" 
                                         style="cursor: pointer;" 
                                         alt="@Model?.ProductName - Ảnh @img.DisplayOrder"
                                         loading="lazy"
                                         decoding="async"
                                         width="100"
                                         height="100"
                                         onclick="changeMainImage(this.src)">
                                </div>
                            }
                            
                            // Fill remaining slots with placeholders if less than 4 images
                            for (int i = productImages.Count + 1; i <= 4; i++)
                            {
                                <div class="col-3">
                                    <img src="https://via.placeholder.com/100x100?text=Img+@i" 
                                         class="img-thumbnail product-thumbnail" 
                                         style="cursor: pointer; opacity: 0.3;" 
                                         alt="@Model?.ProductName - Ảnh @i"
                                         loading="lazy"
                                         decoding="async"
                                         width="100"
                                         height="100">
                                </div>
                            }
                        }
                        else
                        {
                            // No product images - show placeholders
                            for (int i = 1; i <= 4; i++)
                            {
                                <div class="col-3">
                                    <img src="https://via.placeholder.com/100x100?text=Img+@i" 
                                         class="img-thumbnail product-thumbnail" 
                                         style="cursor: pointer;" 
                                         alt="@Model?.ProductName - Ảnh @i"
                                         loading="lazy"
                                         decoding="async"
                                         width="100"
                                         height="100"
                                         onclick="changeMainImage(this.src)">
                                </div>
                            }
                        }
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Product Details -->
    <div class="col-md-7">
        <!-- Product Title & Rating -->
        <div class="mb-3">
            <h1 class="mb-2">@Model?.ProductName</h1>
            <div class="d-flex align-items-center gap-3">
                <div class="text-warning">
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star"></i>
                    <span class="text-dark ms-2">(4.0/5.0)</span>
                </div>
                <span class="badge bg-primary">Còn Hàng</span>
            </div>
            <small class="text-muted">125 đánh giá | 500+ lượt mua</small>
        </div>

        <!-- Price -->
        <div class="mb-4">
            <div class="row align-items-baseline">
                <div class="col-auto">
                    @if (Model?.DiscountPrice.HasValue == true)
                    {
                        <span class="display-5 text-danger fw-bold">@Model.DiscountPrice.Value.ToString("N0")đ</span>
                    }
                    else
                    {
                        <span class="display-5 text-danger fw-bold">@Model?.Price.ToString("N0")đ</span>
                    }
                </div>
                @if (Model?.DiscountPrice.HasValue == true)
                {
                    <div class="col-auto">
                        <span class="h5 text-muted"><s>@Model.Price.ToString("N0")đ</s></span>
                    </div>
                    <div class="col-auto">
                        <span class="badge bg-warning text-dark">-@((int)((1 - Model.DiscountPrice.Value / Model.Price) * 100))%</span>
                    </div>
                }
            </div>
        </div>

        <!-- Product Info -->
        <div class="mb-4">
            <table class="table table-sm">
                @if (!string.IsNullOrEmpty(Model?.SKU))
                {
                    <tr>
                        <th style="width: 30%;">SKU:</th>
                        <td>@Model.SKU</td>
                    </tr>
                }
                @if (!string.IsNullOrEmpty(Model?.Manufacturer))
                {
                    <tr>
                        <th>Hãng Sản Xuất:</th>
                        <td>@Model.Manufacturer</td>
                    </tr>
                }
                @if (Model?.WarrantyPeriod.HasValue == true)
                {
                    <tr>
                        <th>Bảo Hành:</th>
                        <td>@Model.WarrantyPeriod tháng</td>
                    </tr>
                }
                @if (Model?.Weight.HasValue == true)
                {
                    <tr>
                        <th>Cân Nặng:</th>
                        <td>@Model.Weight kg</td>
                    </tr>
                }
                @if (!string.IsNullOrEmpty(Model?.Dimensions))
                {
                    <tr>
                        <th>Kích Thước:</th>
                        <td>@Model.Dimensions</td>
                    </tr>
                }
                <tr>
                    <th>Tồn Kho:</th>
                    @if (Model?.Quantity > 0)
                    {
                        <td><span class="badge bg-success">@Model.Quantity sản phẩm</span></td>
                    }
                    else
                    {
                        <td><span class="badge bg-danger">Hết hàng</span></td>
                    }
                </tr>
            </table>
        </div>

        <!-- Quantity & Add to Cart -->
        <div class="mb-4">
            <div class="row">
                <div class="col-md-4">
                    <label class="form-label fw-bold">Số Lượng:</label>
                    <div class="input-group">
                        <button class="btn btn-outline-secondary" type="button" id="qty-decrease">-</button>
                        <input type="number" class="form-control text-center" id="quantity" value="1" min="1" max="@(Model?.Quantity ?? 1)">
                        <button class="btn btn-outline-secondary" type="button" id="qty-increase">+</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="mb-4 d-grid gap-2">
            @if (Model?.Quantity > 0)
            {
                <button class="btn btn-success btn-lg" id="add-to-cart-btn">
                    <i class="bi bi-cart-plus"></i> Thêm Vào Giỏ Hàng
                </button>
            }
            else
            {
                <button class="btn btn-success btn-lg" disabled>
                    <i class="bi bi-x-circle"></i> Hết Hàng
                </button>
            }
            <button class="btn btn-outline-danger btn-lg" id="add-to-wishlist-btn">
                <i class="bi bi-heart"></i> Thêm Vào Yêu Thích
            </button>
        </div>

        <!-- Shipping Info -->
        <div class="card bg-light">
            <div class="card-body">
                <div class="row mb-2">
                    <div class="col-2 text-center">
                        <i class="bi bi-truck" style="font-size: 1.5rem; color: #1b6ec2;"></i>
                    </div>
                    <div class="col-10">
                        <strong>Miễn Phí Vận Chuyển</strong><br>
                        <small class="text-muted">Giao hàng miễn phí cho đơn từ 500.000đ</small>
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-2 text-center">
                        <i class="bi bi-shield-check" style="font-size: 1.5rem; color: #51cf66;"></i>
                    </div>
                    <div class="col-10">
                        <strong>Bảo Đảm Chất Lượng</strong><br>
                        <small class="text-muted">Tất cả sản phẩm đều chính hãng 100%</small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-2 text-center">
                        <i class="bi bi-arrow-counterclockwise" style="font-size: 1.5rem; color: #ff6b6b;"></i>
                    </div>
                    <div class="col-10">
                        <strong>Hoàn Tiền 30 Ngày</strong><br>
                        <small class="text-muted">Không hài lòng? Hoàn tiền trong 30 ngày</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tabs Section -->
<div class="row mt-5">
    <div class="col-12">
        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab">
                    Mô Tả Chi Tiết
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="specs-tab" data-bs-toggle="tab" data-bs-target="#specs" type="button" role="tab">
                    Thông Số Kỹ Thuật
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab">
                    Đánh Giá (45)
                </button>
            </li>
        </ul>

        <div class="tab-content border border-top-0 p-4">
            <!-- Description Tab -->
            <div class="tab-pane fade show active" id="description" role="tabpanel">
                <h5 class="mb-3">Mô Tả Sản Phẩm</h5>
                @if (string.IsNullOrEmpty(Model?.Description))
                {
                    <p>Không có mô tả sản phẩm</p>
                }
                else
                {
                    <p>@Html.Raw(Model.Description)</p>
                }
            </div>

            <!-- Specs Tab -->
            <div class="tab-pane fade" id="specs" role="tabpanel">
                <h5 class="mb-3">Thông Số Kỹ Thuật</h5>
                <table class="table">
                    <tr>
                        <th>Thông Số</th>
                        <th>Giá Trị</th>
                    </tr>
                    <tr>
                        <td>Model</td>
                        <td>Model 2024</td>
                    </tr>
                    <tr>
                        <td>Công Suất</td>
                        <td>100W</td>
                    </tr>
                    <tr>
                        <td>Điện Áp</td>
                        <td>220V</td>
                    </tr>
                    <tr>
                        <td>Kết Nối</td>
                        <td>USB 3.0, WiFi 6</td>
                    </tr>
                </table>
            </div>

            <!-- Reviews Tab -->
            <div class="tab-pane fade" id="reviews" role="tabpanel">
                <h5 class="mb-4">Đánh Giá Từ Khách Hàng</h5>
                
                <!-- Review Stats -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="text-center">
                            <div class="display-4 text-warning">4.0</div>
                            <div class="text-warning mb-2">
                                <i class="bi bi-star-fill"></i>
                                <i class="bi bi-star-fill"></i>
                                <i class="bi bi-star-fill"></i>
                                <i class="bi bi-star-fill"></i>
                                <i class="bi bi-star"></i>
                            </div>
                            <small class="text-muted">Dựa trên 45 đánh giá</small>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <!-- Rating Bars -->
                        @for (int i = 5; i >= 1; i--)
                        {
                            <div class="mb-2">
                                <div class="d-flex align-items-center gap-2">
                                    <span style="width: 40px;">@i <i class="bi bi-star-fill text-warning"></i></span>
                                    <div class="progress flex-grow-1" style="height: 8px;">
                                        <div class="progress-bar" style="width: @((6 - i) * 20)%"></div>
                                    </div>
                                    <span style="width: 40px;" class="text-end">@((6 - i) * 9)</span>
                                </div>
                            </div>
                        }
                    </div>
                </div>

                <hr>

                <!-- Individual Reviews -->
                <h6 class="mb-3">Các Đánh Giá Gần Đây</h6>
                @for (int i = 1; i <= 3; i++)
                {
                    <div class="mb-3 pb-3 border-bottom">
                        <div class="d-flex justify-content-between mb-2">
                            <strong>Nguyễn Văn A</strong>
                            <small class="text-muted">2 ngày trước</small>
                        </div>
                        <div class="text-warning mb-2">
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                        </div>
                        <p class="mb-0">Sản phẩm rất tốt! Giao hàng nhanh, đóng gói cẩn thận. Tôi rất hài lòng với chất lượng.</p>
                    </div>
                }

                <!-- Add Review Form -->
                <div class="mt-4">
                    <h6>Viết Đánh Giá</h6>
                    <form>
                        <div class="mb-3">
                            <label class="form-label">Đánh Giá</label>
                            <div id="rating-input" style="font-size: 2rem;">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    <i class="bi bi-star" style="cursor: pointer;" data-value="@i"></i>
                                }
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Bình Luận</label>
                            <textarea class="form-control" rows="3" placeholder="Chia sẻ trải nghiệm của bạn..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Gửi Đánh Giá</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Shopping Information Section -->
<div class="row mt-5">
    <div class="col-12">
        <div class="card bg-light">
            <div class="card-body">
                <h3 class="mb-4 text-center">Mua Sắm An Toàn & Tiện Lợi Tại KLDShop</h3>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="d-flex">
                            <i class="bi bi-award-fill text-warning me-3" style="font-size: 2.5rem;"></i>
                            <div>
                                <h5>Sản Phẩm Chính Hãng 100%</h5>
                                <p class="text-muted small mb-0">
                                    Tất cả sản phẩm tại KLDShop đều được nhập khẩu chính hãng từ các nhà phân phối uy tín. 
                                    Chúng tôi cam kết cung cấp tem chống giả và giấy bảo hành đầy đủ từ nhà sản xuất. 
                                    Nếu phát hiện hàng nhái, hoàn tiền 200% giá trị đơn hàng.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="d-flex">
                            <i class="bi bi-truck-front-fill text-primary me-3" style="font-size: 2.5rem;"></i>
                            <div>
                                <h5>Giao Hàng Nhanh Chóng</h5>
                                <p class="text-muted small mb-0">
                                    Miễn phí vận chuyển cho đơn hàng trên 500.000đ. Giao hàng trong 1-3 ngày tại nội thành 
                                    các tỉnh thành lớn, 3-5 ngày tại các tỉnh khác. Đội ngũ giao hàng chuyên nghiệp, 
                                    đảm bảo hàng hóa nguyên vẹn đến tay bạn.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="d-flex">
                            <i class="bi bi-arrow-repeat text-success me-3" style="font-size: 2.5rem;"></i>
                            <div>
                                <h5>Đổi Trả Trong 30 Ngày</h5>
                                <p class="text-muted small mb-0">
                                    Nếu sản phẩm có lỗi hoặc không đúng mô tả, bạn có thể đổi trả trong vòng 30 ngày. 
                                    Quy trình đổi trả đơn giản, nhanh chóng. Chúng tôi hoàn tiền 100% hoặc đổi sản phẩm mới 
                                    theo yêu cầu của bạn.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6 mb-3">
                        <h5><i class="bi bi-shield-lock-fill text-info"></i> Thanh Toán An Toàn</h5>
                        <p class="text-muted small mb-0">
                            Hỗ trợ đa dạng phương thức thanh toán: <strong>COD</strong> (thanh toán khi nhận hàng), 
                            chuyển khoản ngân hàng, ví điện tử (Momo, ZaloPay, VNPay), thẻ tín dụng/ghi nợ quốc tế. 
                            Mọi giao dịch đều được mã hóa SSL/TLS đảm bảo bảo mật tối đa.
                        </p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <h5><i class="bi bi-headset text-danger"></i> Hỗ Trợ Khách Hàng 24/7</h5>
                        <p class="text-muted small mb-0">
                            Đội ngũ tư vấn chuyên nghiệp sẵn sàng hỗ trợ bạn mọi lúc mọi nơi. Liên hệ qua 
                            <strong>Hotline: 1900-xxxx</strong>, email: <strong>support@kldshop.com</strong> 
                            hoặc chat trực tuyến. Cam kết phản hồi trong vòng 24 giờ làm việc.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Related Products -->
<div class="row mt-5">
    <div class="col-12">
        <h3 class="mb-4">Sản Phẩm Liên Quan</h3>
    </div>
    @for (int i = 1; i <= 4; i++)
    {
        <div class="col-md-6 col-lg-3 mb-4">
            <div class="card product-card h-100 shadow-sm">
                <img src="https://via.placeholder.com/250x200?text=Related+@i" class="card-img-top" alt="Related Product">
                <div class="card-body">
                    <h5 class="card-title">Sản Phẩm Liên Quan @i</h5>
                    <div class="text-warning mb-2">
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star"></i>
                    </div>
                    <span class="h6 text-danger fw-bold">999.000đ</span>
                </div>
                <div class="card-footer bg-white border-top">
                    <button class="btn btn-success btn-sm w-100">
                        <i class="bi bi-cart-plus"></i> Thêm Vào Giỏ
                    </button>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <!-- Structured Data (JSON-LD) for SEO -->
    <script type="application/ld+json">
    {
        "@@context": "https://schema.org/",
        "@@type": "Product",
        "name": "@Model?.ProductName",
        "image": "@productImage",
        "description": "@(Model?.Description?.Replace("\"", "\\\"").Replace("\r\n", " ").Replace("\n", " "))",
        "sku": "@Model?.SKU",
        "brand": {
            "@@type": "Brand",
            "name": "@(Model?.Manufacturer ?? "KLDShop")"
        },
        "offers": {
            "@@type": "Offer",
            "url": "@productUrl",
            "priceCurrency": "@currency",
            "price": "@price",
            "priceValidUntil": "@DateTime.Now.AddMonths(1):yyyy-MM-dd",
            "availability": "@availability",
            "seller": {
                "@@type": "Organization",
                "name": "KLDShop"
            }
        },
        "aggregateRating": {
            "@@type": "AggregateRating",
            "ratingValue": "4.0",
            "reviewCount": "125"
        }
    }
    </script>

    <script>
        // Quantity controls
        $('#qty-decrease').click(function () {
            let qty = parseInt($('#quantity').val());
            if (qty > 1) {
                $('#quantity').val(qty - 1);
            }
        });

        $('#qty-increase').click(function () {
            let qty = parseInt($('#quantity').val());
            let max = parseInt($('#quantity').attr('max'));
            if (qty < max) {
                $('#quantity').val(qty + 1);
            }
        });

        // Add to cart
        $('#add-to-cart-btn').click(function () {
            let productId = @Model.ProductId;
            let quantity = parseInt($('#quantity').val());
            
            $.post('@Url.Action("AddToCart", "Cart")', {
                productId: productId,
                quantity: quantity
            }, function (data) {
                if (data.success) {
                    alert(data.message);
                    updateCartBadge();
                } else {
                    alert('Lỗi: ' + data.message);
                }
            });
        });

        // Add to wishlist
        $('#add-to-wishlist-btn').click(function () {
            let productId = @Model.ProductId;
            let $btn = $(this);
            let $icon = $btn.find('i');
            let isInWishlist = $icon.hasClass('bi-heart-fill');
            
            if (isInWishlist) {
                // Remove from wishlist
                $.post('@Url.Action("Remove", "Wishlist")', {
                    productId: productId
                }, function (data) {
                    if (data.success) {
                        alert(data.message);
                        $icon.removeClass('bi-heart-fill').addClass('bi-heart');
                        $btn.removeClass('btn-danger').addClass('btn-outline-danger');
                        updateWishlistBadge();
                    } else {
                        alert('Lỗi: ' + data.message);
                    }
                });
            } else {
                // Add to wishlist
                $.post('@Url.Action("Add", "Wishlist")', {
                    productId: productId
                }, function (data) {
                    if (data.success) {
                        alert(data.message);
                        $icon.removeClass('bi-heart').addClass('bi-heart-fill');
                        $btn.removeClass('btn-outline-danger').addClass('btn-danger');
                        updateWishlistBadge();
                    } else {
                        if (data.requireLogin) {
                            if (confirm('Vui lòng đăng nhập để thêm vào yêu thích. Chuyển đến trang đăng nhập?')) {
                                window.location.href = '@Url.Action("Login", "Account")';
                            }
                        } else {
                            alert('Lỗi: ' + data.message);
                        }
                    }
                });
            }
        });

        // Check wishlist status on page load
        $(document).ready(function () {
            let productId = @Model.ProductId;
            $.get('@Url.Action("Check", "Wishlist")', {
                productId: productId
            }, function (data) {
                if (data.inWishlist) {
                    let $btn = $('#add-to-wishlist-btn');
                    let $icon = $btn.find('i');
                    $icon.removeClass('bi-heart').addClass('bi-heart-fill');
                    $btn.removeClass('btn-outline-danger').addClass('btn-danger');
                }
            });
        });

        // Store original main image URL
        var originalMainImage = $('#main-image').attr('src');

        // Change main image when clicking thumbnail
        function changeMainImage(src) {
            $('#main-image').attr('src', src);
            
            // Add active border to clicked thumbnail
            $('.product-thumbnail').removeClass('border-primary border-3');
            event.target.classList.add('border-primary', 'border-3');
        }

        // Reset to original main image
        function resetMainImage() {
            $('#main-image').attr('src', originalMainImage);
            
            // Remove all active borders from thumbnails
            $('.product-thumbnail').removeClass('border-primary border-3');
        }

        // Rating stars
        $('#rating-input i').click(function () {
            let rating = $(this).data('value');
            $('#rating-input i').each(function () {
                if ($(this).data('value') <= rating) {
                    $(this).removeClass('bi-star').addClass('bi-star-fill');
                } else {
                    $(this).removeClass('bi-star-fill').addClass('bi-star');
                }
            });
        });

        function updateCartBadge() {
            $.get('@Url.Action("GetCartSummary", "Cart")', function (data) {
                $('#cart-count').text(data.itemCount);
            });
        }

        function updateWishlistBadge() {
            $.get('@Url.Action("GetCount", "Wishlist")', function (data) {
                if (data.count > 0) {
                    $('#wishlist-count').text(data.count).show();
                } else {
                    $('#wishlist-count').hide();
                }
            });
        }
    </script>
}
